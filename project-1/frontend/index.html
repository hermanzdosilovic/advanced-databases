<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <title>FERflix</title>
    <style>
        textarea {
            width: 400px;
            height: 200px;
        }

        input {
            width: 400px;
        }

        td {
            padding: 5px;
        }

        .no-border {
            border: none;
        }

        .column {
            float: left;
            width: 50%;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>

<body>
    <h1>FERflix</h1>

    <hr>

    <div class="row">
        <div class="column">
            <h2>Add Movie</h2>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label><strong>Title</strong></label>
                        </td>
                        <td>
                            <input id="add-title" type="text" value="Forrest Gump"><br>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label><strong>Categories</strong></label>
                        </td>
                        <td>
                            <input id="add-categories" type="text" value="Drama; Romance">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label><strong>Summary</strong></label>
                        </td>
                        <td>
                            <textarea
                                id="add-summary">The presidencies of Kennedy and Johnson, the events of Vietnam, Watergate, and other history unfold through the perspective of an Alabama man with an IQ of 75.</textarea><br>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label><strong>Description</strong></label>
                        </td>
                        <td>
                            <textarea
                                id="add-description">Forrest Gump is a simple man with a low I.Q. but good intentions. He is running through childhood with his best and only friend Jenny. His 'mama' teaches him the ways of life and leaves him to choose his destiny. Forrest joins the army for service in Vietnam, finding new friends called Dan and Bubba, he wins medals, creates a famous shrimp fishing fleet, inspires people to jog, starts a ping-pong craze, creates the smiley, writes bumper stickers and songs, donates to people and meets the president several times. However, this is all irrelevant to Forrest who can only think of his childhood sweetheart Jenny Curran, who has messed up her life. Although in the end all he wants to prove is that anyone can love anyone.</textarea><br>
                        </td>
                    </tr>
                    <tr>
                        <td>
                        </td>
                        <td>
                            <button id="add" style="float: right;">Add Movie</button>
                        </td>
                    </tr>
                </tbody>

            </table>
        </div>

        <div class="column">
            <h2>Search Movies</h2>
            <input id="search" type="text" list="suggestions">
            <datalist id="suggestions">
            </datalist>

            <div id="result">
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#add").on("click", function () {
                $.ajax({
                    url: "http://localhost:3000/movie",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        title: $("#add-title").val(),
                        categories: $("#add-categories").val(),
                        summary: $("#add-summary").val(),
                        description: $("#add-description").val()
                    }),
                    success: function (data, textStatus, jqXHR) {
                        alert("Movie successfully added!");
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(`${jqXHR.statusText} (${jqXHR.status})`);
                    }
                });
            });

            var searchInProgress = false;
            $("#search").on("keyup", function () {
                if (searchInProgress) {
                    return;
                }
                searchInProgress = true;
                $.ajax({
                    url: "http://localhost:3000/rpc/movie_search",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        pattern: $("#search").val()
                    }),
                    success: function (data, textStatus, jqXHR) {
                        var resultPreview = `<h4>${data.length} movies found.</h4>`
                        var suggestions = "";
                        for (var i = 0; i < data.length; ++i) {
                            resultPreview += `
                        <table style="border: 1px solid #eee; width: 100%;">
                            <tbody>
                                <tr><td><strong>Rank</strong></td><td>${data[i]["rank"]}</td></tr>
                                <tr><td><strong>ID</strong></td><td>${data[i]["movieid"]}</td></tr>
                                <tr><td><strong>Title</strong></td><td>${data[i]["title"]}</td></tr>
                                <tr><td><strong>Categories</strong></td><td>${data[i]["categories"]}</td></tr>
                                <tr><td><strong>Summary</strong></td><td>${data[i]["summary"]}</td></tr>
                                <tr><td><strong>Description</strong></td><td>${data[i]["description"]}</td></tr>
                            <tbody>
                        </table>
                        </br>
                        `;
                            suggestions += `<option value="${data[i]["title"].replace(/<.?b>/g, "")}"></option>`;
                        }
                        $("#result").html(resultPreview);
                        $("#suggestions").html(suggestions);
                        searchInProgress = false;
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(`${jqXHR.statusText} (${jqXHR.status})`);
                        searchInProgress = false;
                    }
                })
            });
        });
    </script>
</body>

</html>